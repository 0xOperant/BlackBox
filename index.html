<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BlackBox by belldavidr</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">BlackBox</h1>
        <p class="header">Raspbian + openVPN wifi travel router</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/belldavidr/BlackBox/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/belldavidr/BlackBox/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/belldavidr/BlackBox">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/belldavidr">belldavidr</a></p>


      </header>
      <section>
        <h3>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h3>

<p>Below is a list of hardware and software packages I used to create my "black box."  The name is reference to the color-coded system many cryptographers use when referring to plain-text (red data) and encrypted text (black data).  The black box is basically an inline encryption device.  Once connected to the Internet, in a hotel or coffee shop for example, the black box automatically establishes an openVPN tunnel and serves up a WPA2 encrypted wifi hotspot.  Any client device connected to the hotspot is automatically routed through the openVPN tunnel, protecting all data transmissions from eavesdropping.  The tunnel itself is protected by mutual certificate-based authentication, as well as pre-shared TLS keys for packet signing (HMAC), preventing man-in-the-middle and DOS attacks.  This is especially useful during overseas travel.  Furthermore, iptables is used to prevent unwanted access to the device from the untrusted interface (connected to the Internet), or from the VPN tunnel.  Only established, related traffic is allowed.  </p>

<h3>
<a id="concept" class="anchor" href="#concept" aria-hidden="true"><span class="octicon octicon-link"></span></a>Concept</h3>

<p>I developed the black box after experiencing the disarray of openVPN clients on various platforms. Chromebook, for example, cannot use TLS preshared keys for HMAC signing.  Apple iOS devices drop their wifi connections, and therefore openVPN sessions, every time the screen locks.  Android openVPN clients have been buggy as well.  In contrast, the black box is very practical. You simply plug in the power supply and Ethernet cable, and the black box will automatically attempt to establish the openVPN tunnel.  If the tunnel is blocked by a captive portal, you will be prompted to authenticate to the captive portal by the first device you use to connect to the black box's secure wifi hotspot (both Android and iOS support this natively).  Once authenticated, the black box will then establish the openVPN tunnel. If an Ethernet cable is not available, use a second wifi dongle to connect to available public wifi instead.  This interface (wlan1) is then treated just like eth0, which is untrusted and only used to establish the openVPN tunnel. Connecting to public wifi via a second interface is a little more hackish, and will require you to ssh into the black box in order to configure the interface. This can be automated to some extent using wpa_supplicant. </p>

<h3>
<a id="hardware" class="anchor" href="#hardware" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware</h3>

<ul>
<li>Raspberry Pi B+ (or newer)</li>
<li>Sturdy Pi case, preferably with screws (holds together better during travel)</li>
<li>2 ralink chipset-based mini-wifi dongles (must support softAP mode)</li>
<li>5v, 1 amp micro-usb power supply...can even be a battery!</li>
<li>MicroSD card, 8GB minimum, Class 10 preferred for better performance</li>
</ul>

<h3>
<a id="software" class="anchor" href="#software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Software</h3>

<ul>
<li>Raspbian (Debian 7.x-based, download latest image from official website)</li>
<li>openVPN</li>
<li>hostAPD (serves wifi hotspot)</li>
<li>dnsmasq (serves DHCP to clients)</li>
<li>wpa_supplicant (helps with roaming on wifi)</li>
<li>Optional</li>
<li>Iptables-persistent (makes saving iptables easier)</li>
<li>vim (less sadistic than vi)</li>
<li>fail2ban (protects sshd from DOS)</li>
</ul>

<h3>
<a id="BlackBox-Server-Considerations" class="anchor" href="#BlackBox-Server-Considerations" aria-hidden="true"><span class="octicon octicon-link"></span></a>BlackBox Server Considerations</h3>

<p>This is fairly straightforward, and there are many tutorials out there that may suit your needs better than mine.  The first thing you need to decide is where the server will be hosted.  Many people like to use a raspberry pi on their home network.  This is definitely one way to go, and may suffice, depending upon your level of paranoia.  When I am travelling overseas or using unsecured wifi hotspots, I prefer not to connect to my home's IP address.  I have opted for a hosted virtual private server (VPS), instead.  This is where I will lose some readers...there are VPN service providers available at a lower cost than many hosting solutions.  However, if you want more control over your environment, read on!  When selecting a VPS provider, you need to weigh privacy and cost considerations.  For example, Amazon offers a "tier1.micro" level for free for one year.  After that, your costs will increase depending on your bandwidth usage.  Digital Ocean offers a flat $5/month rate, but far less control over security and privacy settings.  There are other providers available...choose the one that provides the best balance of cost and security for your needs.  Or build a pi.  From here on out, I will assume you are using a recent Ubuntu-based server (12.04 LTS or later).  If you are using a pi, Raspbian will work fine.</p>

<h3>
<a id="coming-soon-how-to-build-your-own-blackbox" class="anchor" href="#coming-soon-how-to-build-your-own-blackbox" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coming Soon: How to build your own BlackBox!</h3>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
